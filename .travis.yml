language: rust
matrix:
  include:
    - os: linux
      rust: stable
    - os: linux
      rust: beta
    - os: linux
      rust: nightly
addons:
  apt:
    packages:
      - gcc-8-arm-linux-gnueabi
cache: cargo
install:
  - rustup component add rustfmt
  - rustup target add arm-linux-androideabi
  - rustup target add armv7-linux-androideabi
  - rustup target add aarch64-linux-android
  - rustup target add i686-linux-android
  - rustup target add x86_64-linux-android
script: ci/script.sh
branches:
  only:
    - master
after_success:
  - |
      [ $TRAVIS_BRANCH = master ] &&
      [ $TRAVIS_PULL_REQUEST = false ] &&
      (cd android-ndk-sys; cargo publish --token ${CRATESIO_TOKEN})
  - |
      [ $TRAVIS_BRANCH = master ] &&
      [ $TRAVIS_PULL_REQUEST = false ] &&
      (cd android-ndk; cargo publish --token ${CRATESIO_TOKEN})
